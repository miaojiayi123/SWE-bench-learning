# SWE-agent：基于语言模型（LM）和代理-计算机接口（ACI）的代理

基于论文总结，参考 [SWE-agent 文档](https://swe-agent.com)。

---

## ACI：代理-计算机接口（Agent-Computer Interface）

### ACI 特点
1. 在语言模型（LM）代理和计算机之间的抽象层。
2. 类似于集成开发环境（IDE），专为 LM 优化，提供接口以推动软件工程自动化。
3. 包括代码搜索、文件查看器和文件编辑器。
4. LM 无法直接操作基于 GUI 的应用程序，因缺乏视觉理解能力。ACI 帮助 LM 代理理解应用程序在先前更改后的状态、管理历史记录，并提供高效可靠的动作。

### ACI 设计原则
1. **动作应简单易懂**：减少复杂性，便于 LM 使用。
2. **动作应紧凑高效**：整合操作，单步完成关键任务。
3. **环境反馈应信息丰富但简洁**：如编辑文件时更新修订内容，帮助代理决策。
4. **护栏减轻错误传播并加速恢复**：在 LM 编辑应用前检查代码，防止错误。

---

## SWE-agent 如何为 LM 提供 ACI：技术组件

### 搜索与导航
#### 利用问题描述信号快速定位问题
1. 特殊命令：`find_file`、`search_file`、`search_dir`。
2. 鼓励高效搜索，限制最多返回 50 条结果。

| 类别       | 命令                            | 文档描述                                                                 |
|------------|---------------------------------|-------------------------------------------------------------------------|
| **搜索**   | `search_file <search_term> [<file>]` | 在指定文件中搜索词。若未提供文件，则在当前打开文件中搜索。             |
|            | `search_dir <search_term> [<dir>]`   | 在指定目录的所有文件中搜索词。若未提供目录，则在当前目录搜索。         |
|            | `find_file <file_name> [<dir>]`      | 在指定目录中查找给定文件名的所有文件。若未提供目录，则在当前目录搜索。 |

### 文件查看器（File Viewer）
1. 调用 `open` 命令使用交互式文件查看器，传入相关文件路径。
2. 使用 `scroll_down` 和 `scroll_up` 移动窗口，`goto` 跳转到特定行。

| 类别       | 命令                            | 文档描述                                                                 |
|------------|---------------------------------|-------------------------------------------------------------------------|
| **文件查看器** | `open <path> [<line_number>]` | 打开指定路径的文件。若提供行号，窗口将移动到包含该行。                   |
|            | `goto <line_number>`           | 将窗口移动到显示指定行号。                                               |
|            | `scroll_down`                  | 将窗口向上移动 100 行。                                                  |
|            | `scroll_up`                    | 将窗口向下移动 100 行。                                                  |

### 文件编辑器（File Editor）
#### `edit` 命令解决 Shell-only 编辑的复杂性，提升 LM 效率
1. `edit` 命令与文件查看器协作，允许代理替换打开文件中特定行范围。
2. 集成 linter（护栏），检查语法错误。
3. 丢弃无效编辑，提供反馈。

| 类别       | 命令                                      | 文档描述                                                                 |
|------------|-------------------------------------------|-------------------------------------------------------------------------|
| **文件编辑** | `edit <n>:<m> <replacement_text> end_of_edit` | 将打开文件中第 n 至 m 行（含）替换为给定文本。Python 文件编辑后检查语法错误，若有则不执行。 |
|            | `create <filename>`                      | 创建并打开指定名称的新文件。                                             |

### 上下文管理
- 提供 ACI 命令的正确使用示范，确保代理理解操作。

---

## 结果分析

- **人类用户界面并不总是适合作为代理-计算机接口**：Shell-only 复杂且无反馈。
- **紧凑高效的文件编辑对性能至关重要**：`edit` 单步多行提升效率。
- **护栏改善错误恢复**：拦截语法错误，减少级联失败。

### 代理行为分析
1. **起步**: 复现（`create`）或定位（`find_file` / `search_dir`）。
2. **循环**: “编辑（`edit`）后执行（`python`）”。

---

## Prompt

### Prompt workflow
任务片段开始
  ↓
初始消息
  - (1) 系统模板 (System)
  - (2) 示范模板 (Demonstration)
  - (3) 实例模板 (Instance)
  ↓
第1轮：思考 & 动作
  - 语言模型推理 → 执行环境动作
  ↓
下一步（分支）
  1. 有输出：显示模型动作输出 + 提示下一次动作
  2. 无输出：显示自定义消息“动作无声成功”
  3. 格式错误：提示“前一动作无法解析，需重试”
  ↓
第2-N轮（直到提交动作）
  - 循环上述“下一步”逻辑
  ↓
终止条件
  - 动作是 submit，或
  - 成本限制超限，或
  - 连续 2+ 次格式错误

### system template
**system prompt**
1.settings
2.commands
3.response format

**Is-a OOP中表示分类、继承关系**
每一步提示都基于上一步
命令部分包含单一命令，提交了命令后收到相应后再发出第二个命令

### demonstrate template
在system template之后，作为历史第二条消息展示成功轨迹，帮助 LM 学习命令使用。

### instance template
#### 第三条消息，作为任务实例的入口
问题陈述、指令、建议

### next step template
代理动作执行后的反馈模板，分为有输出和无输出两种情况。

## SWE-agent qualitative analysis 定性分析
**1.定位目标文件，重现问题**
找到问题所在的文件，验证问题是否存在（运行测试文件来检查）
**2.搜索问题相关代码**

**3.编辑代码，修复逻辑问题**

**4.测试修改**

**5.清理并提交**
### 完成上述步骤后对agent的方案进行评估
测试问题是否通过，与golden patch官方修复方案进行对比分析差异和优劣


## Statement 伦理、影响、未来
### 1 伦理

- **风险 1：代码执行安全**
  - 问题：LM 生成代码可能误删文件（ `rm -rf asset/`）。
  - 措施：用 Docker隔离。
- **风险 2：社区扩展恶意注入**
  - 问题：非官方资源可能含恶意任务。
  - 措施：提供官方渠道指南，鼓励贡献整合。
- **风险 3：现实部署后果**
  - 问题：可能被用于恶意代码生产。
  - 措施：开源促进约束研究，供政策实验。

### 2 可重现性

- **开源资源**：代码、文档、推理/评估产物全公开于 GitHub。
- **重现步骤**：简单脚本即可复现论文结果。
- **支持**：在线论坛解答问题。
- **意义**：降低复现门槛，促社区协作。

### 3 局限性与未来工作

- **局限 1：工具集小**
  - 现状：高效但有限。
  - 未来：加工具（如网页浏览、静态分析）提升性能。
- **局限 2：手动 ACI 设计**
  - 现状：依赖手动观察。
  - 未来：自动化设计，探索自我迭代。
- **局限 3：任务范围窄**
  - 现状：仅限编程任务。
  - 未来：跨领域应用（如教育、数据分析），扩展 ACI 原则。




